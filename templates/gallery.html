<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>📸 저장된 탐지 결과 갤러리</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/gallery.css') }}">
</head>
<body>
  <h1>📸 저장된 탐지 결과 갤러리</h1>

  <div class="gallery-wrapper">
    <!-- 필터 영역 -->
    <div class="gallery-controls">
      <form method="get" action="{{ url_for('gallery_bp.show_gallery') }}">
        <label for="site_id">현장:</label>
        <select name="site_id" id="site_id" required>
          <option value="">-- 선택 --</option>
          {% for s in sites %}
            <option value="{{ s.site_id }}"
              {% if s.site_id|string == selected_site %}selected{% endif %}>
              {{ s.site_name }}
            </option>
          {% endfor %}
        </select>

        <label for="date">날짜 (선택):</label>
        <input type="date" name="date" id="date" value="{{ selected_date or '' }}">

        <button type="submit">조회</button>
      </form>
    </div>

    <!-- 이미지 그리드 -->
    <div class="gallery-grid">
      {% for photo in photos %}
        <div class="image-card">
          <!-- 클릭 시 분석 페이지로 복귀 -->
          <a
            href="{{ url_for('upload_bp.waste_disposal') }}"
            onclick="event.preventDefault();
              window.location.href = this.href
                + '?site_name={{ selected_name }}'
                + '&site_date={{ photo.uploaded_at.strftime('%Y-%m-%d') }}'
                + '&result_img={{ selected_name }}/{{ photo.image_filename }}';"
          >
            <img
              src="{{ url_for('main_bp.result_file', filename=selected_name ~ '/' ~ photo.image_filename) }}"
              alt="탐지 이미지"
            >
          </a>
          <div class="image-info">
            <p><strong>업로드일:</strong> {{ photo.uploaded_at.strftime('%Y-%m-%d') }}</p>
            <p><strong>탐지 요약:</strong> {{ photo.detection_summary }}</p>
          </div>
        </div>
      {% endfor %}
      {% if photos|length == 0 %}
        <p style="color:#ccc; text-align:center; width:100%;">저장된 이미지가 없습니다.</p>
      {% endif %}
    </div>
  </div>
</body>
</html>
