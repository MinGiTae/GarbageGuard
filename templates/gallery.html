{% extends 'base.html' %}

{% block title %}ğŸ“¸ ì €ì¥ëœ íƒì§€ ê²°ê³¼ ê°¤ëŸ¬ë¦¬{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/gallery.css') }}">
{% endblock %}

{% block content %}
<br><br>
<h1>ğŸ“¸ ì €ì¥ëœ íƒì§€ ê²°ê³¼ ê°¤ëŸ¬ë¦¬</h1>

<div class="gallery-wrapper">
  <!-- í•„í„° -->
  <div class="gallery-controls">
    <form method="get" action="{{ url_for('gallery_bp.show_gallery') }}">
      <label for="site_id">í˜„ì¥:</label>
      <select name="site_id" id="site_id" required>
        <option value="">-- ì„ íƒ --</option>
        {% for s in sites %}
          <option value="{{ s.site_id }}" {% if s.site_id|string == selected_site %}selected{% endif %}>
            {{ s.site_name }}
          </option>
        {% endfor %}
      </select>

      <label for="date">ë‚ ì§œ (ì„ íƒ):</label>
      <input type="date" name="date" id="date" value="{{ selected_date }}">

      <button type="submit">ì¡°íšŒ</button>
    </form>
  </div>

  <!-- ì´ë¯¸ì§€ ê·¸ë¦¬ë“œ -->
  <div class="gallery-grid">
    {% if photos %}
      {% for photo in photos %}
        <div class="image-card">
          <!-- ìˆ˜ì •: site_idì™€ site_name(=selected_name)ì„ ëª¨ë‘ ì „ë‹¬ -->
          <a href="{{ url_for('upload_bp.waste_disposal',
                                site_id=photo.site_id,
                                site_name=selected_name,
                                site_date=photo.uploaded_at.strftime('%Y-%m-%d'),
                                result_img=selected_folder ~ '/' ~ photo.image_filename
                              ) }}">
            <img
              src="{{ url_for('upload_bp.result_file', subpath=selected_folder ~ '/' ~ photo.image_filename) }}"
              alt="íƒì§€ ì´ë¯¸ì§€"
            />
          </a>
          <div class="image-info">
            <p><strong>ì—…ë¡œë“œì¼:</strong> {{ photo.uploaded_at.strftime('%Y-%m-%d') }}</p>
            <p><strong>íƒì§€ ìš”ì•½:</strong> {{ photo.detection_summary }}</p>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p style="color:#ccc; text-align:center; width:100%;">ì €ì¥ëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
